(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{276:function(e,t,o){"use strict";o.r(t);var a=o(13),n=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"functional-blocks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#functional-blocks"}},[e._v("#")]),e._v(" Functional blocks")]),e._v(" "),t("h2",{attrs:{id:"_2-normative"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-normative"}},[e._v("#")]),e._v(" 2. Normative")]),e._v(" "),t("p",[e._v("The first draft versions of this specification do not include normative parts.")]),e._v(" "),t("h2",{attrs:{id:"_3-informative"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-informative"}},[e._v("#")]),e._v(" 3. Informative")]),e._v(" "),t("h3",{attrs:{id:"_3-2-booking"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-booking"}},[e._v("#")]),e._v(" 3.2. Booking")]),e._v(" "),t("p",[e._v("This specifications provides two flows for implementing an initial booking\ntransaction :")]),e._v(" "),t("ul",[t("li",[e._v("Integrated booking by API: the initial booking is handled by an API exchange\nbetween MaaS platforms and operators. Users stay on their original\napplication, without having to switch to another, and they don't need to be\nauthenticated with the carpooling operator.")]),e._v(" "),t("li",[e._v("Delegated booking by deep link: booking is handled by switching\napplications, with a deep link to access directly to the right page on the\ncarpooling operator application. The user needs to authenticate with the\ncarpooling operator.")])]),e._v(" "),t("p",[e._v("MaaS platforms and carpooling operators MUST support at least one of these two\nflows if they implement booking. They MAY implement both.")]),e._v(" "),t("h4",{attrs:{id:"_3-2-1-flow-independent-specifications"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-flow-independent-specifications"}},[e._v("#")]),e._v(" 3.2.1. Flow independent specifications")]),e._v(" "),t("p",[e._v("Both flows share a common pattern: a "),t("code",[e._v("*Booking")]),e._v(" object with unique\n"),t("code",[e._v("booking_id")]),e._v(" is shared between the MaaS platform and the carsharing operator,\nand its status is subsequently updated (some details of this object may differ\ndepending on the flow).  However, these operations are performed differently\ndepending on the selected booking flow.")]),e._v(" "),t("p",[e._v("All information of a "),t("code",[e._v("Booking")]),e._v(" object apart from its "),t("code",[e._v("status")]),e._v(" attribute are\ndefinitely fixed at creation. For both flows, if any information apart from\n"),t("code",[e._v("status")]),e._v(" needs to be changed, the carsharing operator or MaaS platform MUST\ncreate a new "),t("code",[e._v("Booking")]),e._v(" with a new "),t("code",[e._v("booking_id")]),e._v(', and MUST update the status of\nthe former booking to "CANCELLED".')]),e._v(" "),t("p",[e._v("For both flows, a status change MUST update the "),t("code",[e._v("status")]),e._v(" to a subsequent\nstatus respecting the following order: [ WAITING_CONFIRMATION, CONFIRMED,"),t("br"),e._v("\nCOMPLETED_PENDING_VALIDATION, VALIDATED, CANCELLED ]. "),t("code",[e._v("status")]),e._v(" update requests\nthat do not comply with this rule SHOULD be dismissed (they may be the result\nof an order of receipt different from that of the requests sending).")]),e._v(" "),t("h4",{attrs:{id:"_3-2-2-integrated-booking-by-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-integrated-booking-by-api"}},[e._v("#")]),e._v(" 3.2.2. Integrated booking by API")]),e._v(" "),t("p",[e._v("Integrated booking by API is based on 3 routes described in the "),t("a",{attrs:{href:"standard-covoiturage_openapi.yaml"}},[e._v("OpenAPI\nspecification")]),e._v(" :")]),e._v(" "),t("ul",[t("li",[e._v("POST /bookings : initialize the booking request")]),e._v(" "),t("li",[e._v("PATCH /bookings : modify the state of the booking status to complete the booking flow")]),e._v(" "),t("li",[e._v("GET /bookings/{bookingId} : get the state of the booking")])]),e._v(" "),t("h4",{attrs:{id:"_3-2-3-delegated-booking-by-deep-link"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-delegated-booking-by-deep-link"}},[e._v("#")]),e._v(" 3.2.3. Delegated booking by deep link")]),e._v(" "),t("p",[e._v('This section provides precise guidelines for a carpooling operator and a MaaS\nplatform to implement a "booking" flow for passengers with deep linking, in\naddition to the above flow independent specifications.')]),e._v(" "),t("p",[e._v("There is no specific API endpoint associated to this flow, but the MaaS\nplatform that wishes to retrieve the booking information SHOULD implement the\nbooking feed functional block. In this case, the carpooling operator MUST\ncomply to the booking feed specification.")]),e._v(" "),t("h5",{attrs:{id:"redirection-towards-the-carsharing-operator"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redirection-towards-the-carsharing-operator"}},[e._v("#")]),e._v(" Redirection towards the carsharing operator")]),e._v(" "),t("p",[e._v("The transport operator supporting deep linking MUST provide for each "),t("code",[e._v("Journey")]),e._v("\nshared with the MaaS platform an attribute "),t("code",[e._v("webUrl")]),e._v(", with the full URL (with\nall needed parameters) for the user's device to redirect the passenger from\nthe app of the MaaS platform to the operator's app or website.")]),e._v(" "),t("p",[e._v("The booking flow with a deep link is initiated by the MaaS platform with a\n"),t("code",[e._v("Journey")]),e._v(" object provided by a transport operator (e.g. as a result of a\nprevious search). To do that, it MUST redirect the user to the deep link\ncontained in the\n"),t("a",{attrs:{href:"https://github.com/fabmob/standard-covoiturage/pull/2/files#diff-c722233128f788ea06650bffef56e418732898441b4e2199997c40e9070e3345R269",target:"_blank",rel:"noopener noreferrer"}},[e._v("webUrl"),t("OutboundLink")],1),e._v("\nparameter of the\n"),t("a",{attrs:{href:"https://github.com/fabmob/standard-covoiturage/pull/2/files#diff-c722233128f788ea06650bffef56e418732898441b4e2199997c40e9070e3345R220",target:"_blank",rel:"noopener noreferrer"}},[e._v("Journey"),t("OutboundLink")],1),e._v("\nobject.")]),e._v(" "),t("p",[e._v("If the operator is providing an app (and not a website), one obstacle to\nredirecting the passenger is whether they have the operator's app already\ninstalled in their mobile device or not. If not, the deep link URL SHOULD be\ncapable of redirecting the passenger to the corresponding store instead. At\nthe operator's discretion, this URL can also temporarily store the URL\nparameters for later retrieval. There are third-party services as well that\ncan provide such a solution. This way, after the app is installed, the\nparameters can be recovered to automatically redirect the passenger to the\nbooking flow as if the app had always been installed.")]),e._v(" "),t("p",[e._v("If the operator provides a website or if its app was already installed, then\nfollowing the deep link SHOULD automatically and seamlessly redirect the\npassenger to the operator's booking flow. It is up to the operator to decide\nwhere to start this flow and what to do with the parameters sent to the MaaS\napp in the search to provide the passenger with the best booking experience.")]),e._v(" "),t("p",[e._v("It is up to the passenger to decide whether to book the journey, any other\njourney or none.")]),e._v(" "),t("p",[e._v("If the passenger decides not to book the journey being displayed (or if is not\navailable anymore), the operator MAY provide the means for the passenger to go\nback to the search results on the MaaS app. It is then up to the passenger to\ndecide whether to select another result and repeat the above process. If they\ndecide to book it, it is at the operator's discretion to decide how to\ncontinue guiding the passenger through the booking process.")]),e._v(" "),t("div",{staticClass:"language-mermaid extra-class"},[t("pre",{pre:!0,attrs:{class:"language-mermaid"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("flowchart")]),e._v(" LR\n    A"),t("span",{pre:!0,attrs:{class:"token text string"}},[e._v("[Display trip<br>results<br>on MaaS]")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[e._v("--\x3e")]),t("span",{pre:!0,attrs:{class:"token label property"}},[e._v("|Passenger clicks<br>on result|")]),e._v(" B"),t("span",{pre:!0,attrs:{class:"token text string"}},[e._v("{Is operator app <br/>installed?}")]),e._v("\n    B "),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[e._v("--\x3e")]),t("span",{pre:!0,attrs:{class:"token label property"}},[e._v("|Yes|")]),e._v(" D\n    B "),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[e._v("--\x3e")]),t("span",{pre:!0,attrs:{class:"token label property"}},[e._v("|No|")]),e._v(" K"),t("span",{pre:!0,attrs:{class:"token text string"}},[e._v('["Redirect to store<br>(Search parameters<br>are preserved)"]')]),e._v("\n    K "),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[e._v("--\x3e")]),t("span",{pre:!0,attrs:{class:"token label property"}},[e._v("|App installed|")]),e._v(" D"),t("span",{pre:!0,attrs:{class:"token text string"}},[e._v("[Display<br>trip details]")]),e._v("\n    D "),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[e._v("--\x3e")]),e._v(" E"),t("span",{pre:!0,attrs:{class:"token text string"}},[e._v("{Passenger<br>booked<br>trip?}")]),e._v("\n    E "),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[e._v("-.->")]),t("span",{pre:!0,attrs:{class:"token label property"}},[e._v('|"No, back to results"|')]),e._v(" A\n    E "),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[e._v("-.->")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token label property"}},[e._v("|Yes|")]),e._v(" F"),t("span",{pre:!0,attrs:{class:"token text string"}},[e._v("[Operator sends<br>booking details<br>to MaaS]")]),e._v("\n    F "),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[e._v("-.->")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token label property"}},[e._v("|Back to MaaS|")]),e._v(" G"),t("span",{pre:!0,attrs:{class:"token text string"}},[e._v("((Display trip<br>booked))")]),e._v("\n")])])]),t("h4",{attrs:{id:"_3-2-4-booking-information-push-from-carsharing-operator-to-maas-platform-booking-feed-flow"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-booking-information-push-from-carsharing-operator-to-maas-platform-booking-feed-flow"}},[e._v("#")]),e._v(" 3.2.4. Booking information push from carsharing operator to MaaS platform (booking feed flow)")]),e._v(" "),t("p",[e._v("The booking feed is the channel by which the transport operator sends\ninformation to the MaaS platform, about the booking events happening on the\ntransport operator website or app. The booking feed mechanism relies on an\n"),t("a",{attrs:{href:"https://openid.net/specs/openid-connect-core-1_0.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Open ID Connect 1.0"),t("OutboundLink")],1),e._v('\nidentity layer where the Provider is the MaaS platform, subsequently referred\nto as "MaaS connect". See '),t("a",{attrs:{href:"#33-authentication-across-platforms-maas-connect"}},[e._v("the dedicated\nsection")]),e._v(" for further\ninformation. This section adds up to the above flow independent\nspecifications.")]),e._v(" "),t("p",[e._v("The MaaS platform needs to implement the following endpoint:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("POST /booking_events")])])]),e._v(" "),t("p",[e._v('A transport operator offering booking by deep link MUST accept authentication\nvia "MaaS connect".')]),e._v(" "),t("p",[e._v('A MaaS platform SHOULD provide a "MaaS Connect" identity layer in order to get\nback information on booking events happening on the platform of the transport\noperator. In that case, it also MUST provide an API endpoint matching the\n'),t("code",[e._v("POST /booking_events")]),e._v(" specification. Moreover, the passenger MUST be\nauthenticated using MaaS Connect at the time of the redirection to allow the\nbooking feed.")]),e._v(" "),t("p",[e._v("The booking feed flow starts as soon as a booking is created, regardless of\nwhether the trip was first consulted on the MaaS app. It sends booking data to\nthe MaaS platform. It allows the MaaS platform to support use-cases for which\nbooking data need to be instantly available (real-time reporting, incentive\nprogram, pricing bundles,...).")]),e._v(" "),t("p",[e._v("If the MaaS platform is offering the "),t("code",[e._v("POST /booking_events")]),e._v(" endpoint, and once\na booking is created, the operator MUST send the booking details to the MaaS\nplatform. The operator MUST also notify every "),t("code",[e._v("status")]),e._v(" update of the booking\nto the MaaS plateform. As specified in "),t("a",{attrs:{href:"#32-booking"}},[e._v("the introduction of the booking\nsection")]),e._v(", every other change MUST be operated by creating a new "),t("code",[e._v("Booking")]),e._v("\nobject and udating the "),t("code",[e._v("status")]),e._v(' of the former booking to "CANCELLED".')]),e._v(" "),t("p",[e._v("A status update with the "),t("code",[e._v("POST /booking_events")]),e._v(" endpoint MUST repeat the whole\n"),t("code",[e._v("Booking")]),e._v(" object each time as redunduncy allows for a better resilience to\ncommunication failures (e.g. a status update event can be processed even if\nthe booking creation event has been missed).")])])}),[],!1,null,null,null);t.default=n.exports}}]);